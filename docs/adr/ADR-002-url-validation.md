# ADR-002: URL Validation for Media Links
Дата: 20-10-2025
Статус: Accepted

## Context
Поле `url` в медиа-элементах принимает произвольные строки без проверки. Это создаёт риски XSS, открытых редиректов и фишинговых атак.

## Decision
Валидировать все URL с помощью Pydantic с проверкой:
- Разрешённые схемы: http, https
- Запрещённые домены (внутренние, localhost)
- Максимальная длина URL: 2000 символов

## Consequences
**Плюсы:**
- Защита от XSS и открытых редиректов
- Предотвращение фишинговых атак
- Улучшение качества данных

**Минусы:**
- Ограничение функциональности для нестандартных URL
- Дополнительная валидация на стороне сервера

## Security Impact
- Митигация рисков межсайтового скриптинга
- Связь с NFR-05 (безопасность API эндпоинтов)
- Митигация риска R2 (SQL Injection через API)

## Rollout Plan
1. Добавить кастомный валидатор URL в Pydantic схему
2. Обновить существующие данные через миграцию
3. Добавить тесты для валидации URL
4. Валидация на уровне схемы перед сохранением в БД

## Links
- NFR-05 (безопасность API эндпоинтов)
- R2 (SQL Injection через API)
- tests/test_media.py::test_url_validation
