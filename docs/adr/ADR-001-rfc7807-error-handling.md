# ADR-001: RFC 7807 Error Handling
Дата: 20-10-2025
Статус: Accepted

## Context
Текущий формат ошибок API (`{"error": {"code": "...", "message": "..."}}`) нестандартный и не поддерживает трассировку через correlation_id. Это затрудняет отладку и мониторинг в продакшене.

## Decision
Принять стандарт RFC 7807 ("Problem Details for HTTP APIs") для всех ошибок API. Добавить автоматическую генерацию correlation_id для каждой ошибки.

## Consequences
**Плюсы:**
- Стандартизированный формат ошибок
- Улучшенная трассируемость через correlation_id
- Совместимость с инструментами мониторинга

**Минусы:**
- Изменение формата ответов для существующих клиентов
- Небольшое увеличение размера ответов с ошибками

## Security Impact
- Улучшение мониторинга безопасности через correlation_id
- Связь с NFR-09 (логирование безопасности)
- Митигация риска R10 (недостаточное логирование)

## Rollout Plan
1. Реализовать middleware для обработки ошибок
2. Обновить существующие обработчики ошибок
3. Добавить тесты для проверки формата
4. Выпустить как мажорную версию API

## Links
- NFR-09 (логирование безопасности)
- R10 (недостаточное логирование)
- tests/test_errors.py::test_rfc7807_format
